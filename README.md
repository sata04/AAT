# AAT (Acceleration Analysis Tool) v8.3

## 概要
AATは微小重力環境下での実験データを分析するためのツールです。Inner CapsuleとDrag Shieldの加速度データを読み込み、重力レベルを計算・可視化し、統計的分析を行うことができます。

## 主な機能
- CSVファイルからの加速度データ読み込み
- 重力レベルの計算と可視化
- 同期点を基準にした時間の調整
- データのフィルタリング
- 最小標準偏差ウィンドウの検出と統計分析
- G-quality評価モードによる詳細な重力レベル分析
- 複数データの比較分析
- 結果のExcelファイル出力とグラフの保存
- 元の加速度データの保存機能
- キャッシュ機能（処理済みデータの再利用が可能）
- ファイル読み込み時のG-quality自動評価機能
- 詳細な処理状況表示と進捗バー
- バックグラウンドでのG-quality解析によるUIの応答性向上

## システム要件
- Python 3.7以上
- 必要なライブラリ:
  - PyQt6
  - matplotlib
  - numpy
  - pandas
  - openpyxl

## インストール方法
1. リポジトリをクローン:
   ```
   git clone https://github.com/sota04/AAT.git
   ```

2. 必要なライブラリをインストール:
   ```
   pip install -r requirements.txt
   ```

## 使用方法
1. アプリケーションの起動:
   ```
   python main.py
   ```

2. CSVファイルの選択:
   - 「CSVファイルを選択」ボタンをクリックして、分析したいデータファイルを選択します。
   - 複数のファイルを選択することも可能です。
   - CSVファイル内の列が自動検出されない場合は、列選択ダイアログが表示されます。
   - 処理済みデータがあれば再利用するか確認されます。

3. データの分析:
   - 選択されたファイルのデータが自動的に処理され、グラフが表示されます。
   - グラフには、Inner CapsuleとDrag Shieldの重力レベルが時間の関数として表示されます。
   - 下部のテーブルには統計情報が表示されます。
   - 処理状況がリアルタイムで表示されます。

4. 表示モードの切替:
   - 「全体を表示」ボタンで、フィルタリング前の全データを表示できます。
   - 「複数ファイルを比較」ボタンで、複数のファイルのデータを同時に比較できます。
   - データセット選択コンボボックスで、個別のファイル表示に切り替えることができます。

5. G-quality分析:
   - 「G-quality評価モード」ボタンを押すと、異なるウィンドウサイズでの重力レベルの変動を詳細に分析します。
   - この分析により、様々なウィンドウサイズにおける最小標準偏差区間の平均重力レベルとその標準偏差を確認できます。
   - 解析はバックグラウンドスレッドで実行され、UIがブロックされることなく進捗状況がリアルタイムで表示されます。
   - G-quality分析の結果はグラフとExcelファイルの両方に保存されます。
   - G-quality評価は設定によりファイル読み込み時に自動的に実行することも可能です。

6. 設定変更:
   - 「設定」ボタンをクリックして、分析パラメータをカスタマイズできます。
   - キャッシュ使用設定やG-quality自動評価の有効/無効を切り替えられます。

## 設定パラメータ
設定ダイアログでは以下のパラメータを調整できます：

### データ入力設定
- データ列名（時間、加速度）の指定
- サンプリングレート (Hz)
- 重力定数 (m/s²)

### パフォーマンス設定
- 処理済みデータをキャッシュするかどうか
- ファイル読み込み時にG-quality評価を自動計算するかどうか

### グラフ表示設定
- グラフのY軸範囲

### 解析設定
- 加速度同期閾値 (m/s²)
- 終了重力レベル (G)
- 解析ウィンドウサイズ (秒)
- 終了点の開始点からの最小秒数 (秒)

### G-quality解析設定
- 開始ウィンドウサイズ (秒): G-quality解析の最小ウィンドウサイズ
- 終了ウィンドウサイズ (秒): G-quality解析の最大ウィンドウサイズ
- ステップサイズ (秒): 隣接するウィンドウサイズ間の増分値

## G-quality解析について
G-quality解析は、様々なサイズの時間窓に対する重力レベルの変動を評価し、最適な微小重力環境を特定するための重要な分析手法です：

- 異なるウィンドウサイズ（0.1秒から1.0秒など）での標準偏差が最小となる区間を特定
- 各ウィンドウサイズで算出された最小標準偏差区間の平均重力レベルと標準偏差を表示
- Inner CapsuleとDrag Shieldの両方に対して別々に評価を行い、比較可能
- 結果は直感的なグラフとして可視化され、数値データとしてExcelに保存

この分析により、実験条件に最適な時間窓の選択や、微小重力品質の定量的評価が可能になります。

## ファイル構成
- `main.py`: アプリケーションのエントリーポイント
- `config.json`: 設定ファイル
- `core/`: コア機能モジュール
  - `data_processor.py`: データ処理機能
  - `statistics.py`: 統計分析機能
  - `export.py`: データエクスポート機能
  - `config.py`: 設定管理機能
  - `logger.py`: ログ機能
  - `cache_manager.py`: キャッシュ管理機能
- `gui/`: グラフィカルユーザーインターフェース
  - `main_window.py`: メインウィンドウ実装
  - `settings_dialog.py`: 設定ダイアログ
  - `column_selector_dialog.py`: 列選択ダイアログ
  - `workers.py`: バックグラウンド処理用ワーカークラス（非同期G-quality解析）

## 出力ファイルとディレクトリ構造
処理結果は元のCSVファイルと同じディレクトリの `results_AAT` フォルダ内に保存されます：

```
<元のCSVファイルのディレクトリ>/
└── results_AAT/
    ├── <ファイル名>.xlsx  # 重力レベルデータと統計情報
    ├── cache/            # 処理済みデータのキャッシュ
    │   ├── <キャッシュファイル>.pickle
    │   └── <キャッシュファイル>_raw.h5
    └── graphs/
        ├── <ファイル名>_gl.png  # 重力レベルグラフ
        └── <ファイル名>_gq.png  # G-quality分析グラフ（G-quality評価モード実行時）
```

Excelファイルには以下のシートが含まれます：
- `Gravity Level Data`: 時間と重力レベルのデータ
- `Gravity Level Statistics`: 統計情報
- `Acceleration Data`: 元の加速度データ
- `G-quality Analysis`: G-quality分析結果（G-quality評価モード実行時）

## 既知の問題
- macOSでのウィンドウ移動に関する警告が表示されることがありますが、機能には影響しません
- 非常に大きなCSVファイル（1GB以上）を処理する場合、メモリ使用量に注意してください

## ライセンス
このソフトウェアはApache License 2.0の下で公開されています。詳細はLICENSE.mdファイルを参照してください。

## コンタクト
バグ報告や機能リクエストはGitHubのissueトラッカーにてお願いします：
https://github.com/sota04/AAT/issues
