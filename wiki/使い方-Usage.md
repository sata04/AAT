# 使い方 - Usage

このページでは、AATの基本的な使い方を説明します。

---

## 🚀 アプリケーションの起動

### コマンドラインから起動

```bash
# 仮想環境が有効化されていることを確認
source .venv/bin/activate  # macOS/Linux
# または .venv\Scripts\activate  # Windows

# アプリケーションを起動
uv run python main.py
```

### macOSアプリバンドルから起動

ビルド済みの`AAT.app`をダブルクリックするだけで起動します。

---

## 📊 基本的な操作フロー

### ステップ1: CSVファイルの準備

AATで分析するCSVファイルには、以下の列が必要です:

- **時間列**: タイムスタンプまたは経過時間
- **加速度列**:
  - Inner Capsule の加速度データ
  - Drag Shield の加速度データ（オプション）

#### CSVファイルの例

```csv
Time,Inner_Accel,Drag_Accel
0.000,-0.05,0.02
0.001,-0.04,0.03
0.002,-0.06,0.01
...
```

**列名の柔軟性**:

AATは列名を自動検出します。以下のような列名に対応しています:

- **時間列**: `time`, `時間`, `秒`, `s`, `sec`, `t` など
- **加速度列**: `acc`, `accel`, `acceleration`, `加速度`, `g` など（センサー名ではなく加速度を示す語を優先）

---

### ステップ2: データファイルの読み込み

1. メインウィンドウの「**CSVファイルを選択**」ボタンをクリック
2. 分析したいCSVファイルを選択
3. ファイルが複数ある場合は、複数選択も可能（Ctrl/Cmdキーを押しながらクリック）

#### 列の手動選択

AATが列を自動検出できない場合、列選択ダイアログが表示されます:

1. 「時間列」のドロップダウンから時間データの列を選択
2. 「Inner Capsule加速度列」を選択
3. 「Drag Shield加速度列」を選択（存在する場合）
4. 「OK」をクリック

---

### ステップ3: データの確認

データが読み込まれると、以下が自動的に表示されます:

#### グラフ表示

- **横軸**: 時間（秒）
- **縦軸**: 重力レベル（G単位）
- **青線**: Inner Capsule の重力レベル
- **赤線**: Drag Shield の重力レベル（存在する場合）

#### 統計情報テーブル

画面下部のテーブルに以下の情報が表示されます:

| 項目 | 説明 |
|------|------|
| **ファイル名** | 読み込んだCSVファイル名 |
| **Inner 平均G** | Inner Capsuleの平均重力レベル |
| **Inner 開始時間** | 分析開始時刻 |
| **Inner 標準偏差** | Inner Capsuleの標準偏差 |
| **Drag 平均G** | Drag Shieldの平均重力レベル |
| **Drag 開始時間** | 分析開始時刻 |
| **Drag 標準偏差** | Drag Shieldの標準偏差 |
| **処理時間** | データ処理にかかった時間 |

---

### ステップ4: 結果の保存

データ処理が完了すると、以下のファイルが自動的に保存されます:

#### 出力ファイルの場所

```
<元のCSVファイルのディレクトリ>/
└── results_AAT/
    ├── <ファイル名>.xlsx         # Excel形式の分析結果
    ├── cache/                    # キャッシュファイル
    │   ├── *.pickle
    │   └── *_raw.h5
    └── graphs/                   # グラフ画像
        ├── <ファイル名>_gl.png   # 重力レベルグラフ
        └── <ファイル名>_gq.png   # G-quality分析グラフ（実行時のみ）
```

#### Excelファイルの内容

生成されたExcelファイルには以下のシートが含まれます:

1. **Gravity Level Data**: 時間と重力レベルのデータ
2. **Gravity Level Statistics**: 統計情報
3. **Acceleration Data**: 元の加速度データ
4. **G-quality Analysis**: G-quality評価結果（G-qualityモード実行時のみ）

---

## 🔧 主な機能

### 1. 範囲選択と統計表示

グラフ上で特定範囲の詳細統計を確認できます:

1. グラフ上でマウスを**ドラッグ**して範囲を選択
2. 統計情報ダイアログが自動表示
3. 以下の統計情報が表示されます:
   - 平均値
   - 絶対値の平均
   - 標準偏差
   - 最小値・最大値
   - 範囲
   - データポイント数

### 2. G-quality評価モード

微小重力環境の品質を詳細に評価する機能です:

1. 「**G-quality評価モード**」ボタンをクリック
2. 進捗バーで処理状況を確認
3. 0.1秒〜1.0秒を0.05秒刻み（デフォルト19ステップ）で分析
4. 結果がグラフとExcelファイルに保存

詳細は **[[G-quality評価-G-quality-Evaluation]]** をご覧ください。

### 3. 比較モード

複数のデータセットを同時に表示して比較できます:

1. メニューバー「表示」→「比較モード」をチェック
2. 複数のCSVファイルを読み込む
3. すべてのデータセットが同じグラフ上に表示されます

### 4. 全体表示モード

すべてのデータポイントを一度に表示します:

1. メニューバー「表示」→「全体表示」をチェック
2. フィルタリングされていない全データが表示されます

### 5. テーマ切替

UIのテーマを変更できます:

1. メニューバー「表示」→「テーマ」を選択
2. 以下から選択:
   - **システムデフォルト**: OSの設定に従う
   - **ダークモード**: 暗い背景
   - **ライトモード**: 明るい背景

---

## ⚙️ 設定のカスタマイズ

### 設定ダイアログを開く

メニューバー「ファイル」→「設定」を選択

### 主な設定項目

| 設定項目 | 説明 | デフォルト値 |
|---------|------|-------------|
| **サンプリングレート** | データの周波数（Hz） | 1000 |
| **重力定数** | 基準重力値（m/s²） | 9.797578 |
| **加速度閾値** | 同期点検出の閾値（m/s²） | 5.0 |
| **ウィンドウサイズ** | 分析の時間窓（秒） | 0.1 |
| **終了重力レベル** | フィルタリング閾値（G） | 8.0 |
| **開始点からの最小秒数** | 終了点検出を始めるまでスキップする秒数 | 0.7 |
| **キャッシュ使用** | 高速処理の有効化 | ON |
| **G-quality自動計算** | 読み込み時の自動評価 | ON |
| **Inner加速度反転** | センサーの向き補正 | ON |

詳細は **[[設定-Configuration]]** をご覧ください。

---

## 💡 使用上のヒント

### キャッシュの活用

- 一度処理したファイルは自動的にキャッシュされます
- 同じファイルを再度読み込む際は、高速に処理されます
- 設定を変更すると、自動的に再計算されます

### ファイル名の管理

- 出力ファイル名は元のCSVファイル名に基づいて自動生成されます
- わかりやすいファイル名を付けておくと、後で結果を探しやすくなります

### バッチ処理

- 複数のCSVファイルを一度に選択して、連続処理できます
- 各ファイルの結果は自動的に保存されます

---

## ❓ よくある質問

### Q: CSVファイルが読み込めない

**A**: 以下を確認してください:

- ファイルがUTF-8またはShift-JIS（CP932）エンコーディングか
- 時間列と加速度列が含まれているか
- 列選択ダイアログで手動選択を試してください

### Q: グラフが表示されない

**A**: 以下を確認してください:

- データに有効な値が含まれているか
- ウィンドウサイズが適切か（設定で調整可能）
- ログファイルでエラーメッセージを確認

### Q: 処理が遅い

**A**: 以下を試してください:

- キャッシュ機能を有効にする
- 不要なバックグラウンドアプリを終了
- データサイズが大きい場合は、ファイルを分割

詳細は **[[トラブルシューティング-Troubleshooting]]** をご覧ください。

---

## 🚀 次のステップ

- **[[GUI操作ガイド-GUI-Guide]]** - UIの詳細機能を学ぶ
- **[[データ解析パイプライン-Data-Analysis-Pipeline]]** - データ処理の仕組みを理解
- **[[使用例-Examples]]** - 具体的な使用例を見る
